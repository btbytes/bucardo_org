<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="" xml:lang="en" lang="en" dir="ltr">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>{PageTitle}Bucardo</title>
		<style type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "/css/common/shared.css";
			@import "/css/BucardoGreen/main-glossy.css";
		/*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="?303" />
		<!--[if lt IE 7]><meta http-equiv="imagetoolbar" content="no" /><![endif]-->
	</head>
<body class="mediawiki  ltr ">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
		<div id="bodyContent">
			<div id="contentSub"></div>
			<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<p><strong>NOTE: This information is for Bucardo 4 only. If you are using version 5 or higher, none of the below is needed</strong></p>

<p>Best practices for cron jobs. A quick suggestion:</p>

<p>On each database that is used as a master (e.g. has a bucardo_delta table):</p>

<p><code class="highlighter-rouge"> */15 * * * * psql -X -q -d masterhost -U bucardo -c "SELECT</code>
<code class="highlighter-rouge"> bucardo_purge_delta('10 minutes'::interval)"</code></p>

<p>On the main Bucardo database:</p>

<p><code class="highlighter-rouge"> */30 * * * * psql -X -q -d bucardo -U bucardo -c "SELECT</code>
<code class="highlighter-rouge"> bucardo_purge_q_table('5 minutes'::interval)"</code></p>

<p>Once data is replicated, it gets moved from the master_q table to freezer.child_q_YYMMDD tables. If you want to keep this data around, simply do nothing, but note this will cause your bucardo database to grow. On some installations, this may negatively affect performance. If you wish to keep those tables pruned, that can be accomplished with a cron job as well. For example, you can have an /etc/cron.daily/bucardo_daily_purge file like:</p>

<p><code class="highlighter-rouge"> #!/bin/bash</code>
<code class="highlighter-rouge"> echo ========BEGIN DAILY PURGE ============= &gt;&gt; /var/log/bucardo-purge</code>
<code class="highlighter-rouge"> date &gt;&gt; /var/log/bucardo-purge</code>
<code class="highlighter-rouge"> echo ======================================= &gt;&gt; /var/log/bucardo-purge</code>
<code class="highlighter-rouge"> PGPASSWORD=`grep dbpass /etc/bucardorc | awk -F '=' '{print $2;}'`</code>
<code class="highlighter-rouge"> export PGPASSWORD</code>
<code class="highlighter-rouge"> /usr/bin/psql -U bucardo &lt; /usr/local/share/bucardo/bucardo_daily_purge.sql &gt;&gt; /var/log/bucardo-purge 2&gt;&amp;1</code>
<code class="highlighter-rouge"> DROP_OLD_CHILD_Q="DROP TABLE freezer.child_q_"</code>
<code class="highlighter-rouge"> DROP_OLD_CHILD_Q+=`/bin/date --date yesterday "+%Y%m%d"`</code>
<code class="highlighter-rouge"> DROP_OLD_CHILD_Q+=';' </code>
<code class="highlighter-rouge"> echo $DROP_OLD_CHILD_Q | /usr/bin/psql -U bucardo &gt;&gt; /var/log/bucardo-purge 2&gt;&amp;1  </code>
<code class="highlighter-rouge"> echo =========END DAILY PURGE ============== &gt;&gt; /var/log/bucardo-purge</code></p>

<p>Be sure to adjust the timeframe for the date –date command above to appropriately suit your environment. If your replication takes longer than a day, for instance, the above will cause you problems. The file bucardo_daily_purge.sql in this example looks like:</p>

<p><code class="highlighter-rouge"> DELETE FROM q WHERE (started &lt; now() + '1 day ago'::interval OR ended &lt; now() + '1 day ago'::interval OR aborted &lt; now() + '1 day ago'::interval OR cdate &lt; now() + '1 day ago'::interval) AND (ended IS NULL OR aborted IS NULL);</code></p>

<p>which cleans up q table entries that do not get taken care of by the bucardo_purge_q_table function.</p>

</div>
			<div id='catlinks' class='catlinks catlinks-allhidden'></div>			<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div class="portlet" id="p-logo">
	<h2><a href="/"Array>bucardo.org</a></h2>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
</div>
</body></html>
